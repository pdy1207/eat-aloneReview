<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì´ì§‘ì–´ë•Œ? | ë¦¬ë·°</title>
    <link rel="stylesheet" href="../public/css/style.css" />
    <link rel="stylesheet" href="../public/css/review.css" />
    <link
      rel="shortcut icon"
      href="../public/favicon.ico"
      type="image/x-icon"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.4.min.js"
      integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div style="position: fixed; z-index: 1000; width: 100%">
      <header class="Header__Content">
        <div class="house-header__Box">
          <div class="house-header__Titile">
            <div class="house-logo">
              <a href="/"><h1 class="reveal-text">ì´ì§‘ì–´ë•Œ?</h1></a>
            </div>
            <div class="house-search">
              <div class="house-search__Box">
                <button
                  class="house-search__Button"
                  type="button"
                  aria-label="ê²€ìƒ‰í•˜ê¸° ë²„íŠ¼"
                >
                  <img
                    src="https://dcicons.s3.ap-northeast-1.amazonaws.com/new/images/web/react_components/SearchQueryInput/search.png"
                    alt=""
                  /></button
                ><input
                  class="search-input"
                  placeholder="ì§€ì—­, ìŒì‹ ë˜ëŠ” ì‹ë‹¹ëª… ì…ë ¥"
                  value=""
                />
              </div>
            </div>
            <div class="auth-login__Box">
              <a href="/login">ë¡œê·¸ì¸</a>
              <a href="/MyPage">ë§ˆì´í˜ì´ì§€</a>
            </div>
          </div>
        </div>
      </header>
    </div>
    <div id="container-wrap">
      <div>
        <div id="subleft-cont">
          <div class="mini-map">
            <input id="lat" style="display: none" value="<%= data.dataLat %>" />
            <input id="lng" style="display: none" value="<%= data.dataLng %>" />
            <div id="map2" class="map" tabindex="0" value="<%= data.title %>">
              <div class="naver">
                <div>
                  <a
                    href="https://ssl.pstatic.net/static/maps/mantle/notice/legal.html"
                    target="_blank"
                    ><img
                      src="https://ssl.pstatic.net/static/maps/mantle/2x/naver-normal-new.png"
                      width="48"
                      height="17"
                      alt="NAVER"
                  /></a>
                </div>
              </div>
            </div>
            <a class="delisor-search">
              <strong>'<%= data.title %>'</strong>
              <br />
              <br />
              ë§›ì§‘ ë” ê²€ìƒ‰í•´ë³´ê¸°
            </a>
          </div>
        </div>

        <div id="subright-cont">
          <div>
            <div class="main-content">
              <ul class="main-content__pic">
              <% for(var i=0; i<data.image.length; i++) { %>
                <li class="img btn-gallery-open" data-index="0">
                  <img
                    src="<%= data.image[i] %>"
                    style="width: 100%; height: auto; margin-top: -55px"
                    alt="ë§›ì§‘ ì‚¬ì§„"
                  />
                </li>
                <% } %>
              </ul>
              <div class="tit-point">
                <p class="tit"><%= data.title %></p>
              </div>
              <div class="btxt">
                <a><%= data.space %></a> |
                <a class="btxt"><%= data.subTitle %></a>
              </div>
              <div class="sns-grade">
                <p class="grade">
                  <strong
                    style="
                      font-size: 18px;
                      vertical-align: middle;
                      padding-right: 8px;
                    "
                    ><%= data.score %>ì </strong
                  >
                  <span class="point">
                    23ëª…ì˜ í‰ê°€ <strong id="lbl_review_point">4.3ì </strong>
                  </span>
                  <span id="lbl_review_star" class="star"
                    ><i style="width: 86%"></i
                  ></span>
                </p>
              </div>
              <div class="favor-pic-appra">
                <a href="JavaScript:void(0);" class="favor" value="Y"
                  ><span>ì¢‹ì•„ìš”(<i class="num">401</i>)</span></a
                >
                <a href="" class="share" id="Rest__Share"><span>ê³µìœ </span></a>
                <button class="appra Profile__Evaluation">
                  <span>í‰ê°€í•˜ê¸°</span>
                </button>
              </div>
            </div>

            <p class="gap20"></p>

            <div class="s-list basic-info">
              <ul class="list">
                <li class="locat">
                  <a target="_blank"><%= data.address %></a>
                  
                    <button class="Move__Map__Button">ì§€ë„ë¥¼ í´ë¦­ í•´ì£¼ì„¸ìš” ğŸ—ºï¸</button>
                  
                </li>
                <li class="tel"><%= data.number %></li>
                <li class="tag" st>
                  <a><%= data.hashTag %></a>
                </li>
                <li class="char">
                  <a><%= data.plus %></a>
                </li>
                <li id="Favor__User__Popup" class="favor button">
                  ì´ ì‹ë‹¹ì— 401ëª…ì˜ ì¢‹ì•„ìš”í•œ ì‚¬ìš©ìê°€ ìˆìŠµë‹ˆë‹¤.
                </li>

                <li
                  class="feedback button"
                  style="
                    background: url(https://s3-ap-northeast-1.amazonaws.com/dcicons/new/images/web/profile/profile-feedback@2x.png)
                      no-repeat left;
                    background-size: 20px;
                  "
                >
                  <%= data.info %>
                </li>
              </ul>
            </div>

            <p class="gap20"></p>

            <div id="div_detail" class="s-list detail-info">

              <div class="menu-info short">
                <p class="tit">ë©”ë‰´ì •ë³´</p>
                <ul class="list Restaurant_MenuList">
                <% for(var i=0; i<data.menu.length; i++) { %>
                  <li>
                    <p class="l-txt Restaurant_MenuItem">
                      <span class="Restaurant_Menu"><%= data.menu[i] %></span></span>
                    </p>
                    <p class="r-txt Restaurant_MenuPrice"><%= data.price[i] %> ğŸ’°</p>
                  </li>
                <% } %>
                </ul>
              </div>

              <div class="taste-tag">
                <p class="tit">ë§›ì§‘íƒœê·¸</p>
              </div>
              <div class="tr_hashTag_area">
                <p><strong>í•´ì‹œíƒœê·¸ êµ¬í˜„</strong></p>
                <div class="form-group">
                  <input type="hidden" value="" name="tag" id="rdTag" />
                </div>

                <ul id="tag-list"></ul>

                <div class="form-group">
                  <input
                    type="text"
                    id="tag"
                    size="7"
                    placeholder="ì—”í„°ë¡œ í•´ì‹œíƒœê·¸ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”."
                    style="width: 300px"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('footer.html') %>

    <script>
      $(document).ready(function () {
        var tag = {};
        var counter = 0;

        // ì…ë ¥í•œ ê°’ì„ íƒœê·¸ë¡œ ìƒì„±í•œë‹¤.
        function addTag(value) {
          tag[counter] = value;
          counter++; // del-btn ì˜ ê³ ìœ  id ê°€ ëœë‹¤.
        }

        // tag ì•ˆì— ìˆëŠ” ê°’ì„ array type ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ë„˜ê¸´ë‹¤.
        function marginTag() {
          return Object.values(tag).filter(function (word) {
            return word !== "";
          });
        }

        // ì„œë²„ì— ì œê³µ
        $("#tag-form").on("submit", function (e) {
          var value = marginTag(); // return array
          $("#rdTag").val(value);

          $(this).submit();
        });

        $("#tag").on("keypress", function (e) {
          var self = $(this);

          //ì—”í„°ë‚˜ ìŠ¤í˜ì´ìŠ¤ë°” ëˆŒë €ì„ë•Œ ì‹¤í–‰
          if (e.key === "Enter" || e.keyCode == 32) {
            var tagValue = self.val(); // ê°’ ê°€ì ¸ì˜¤ê¸°

            // í•´ì‹œíƒœê·¸ ê°’ ì—†ìœ¼ë©´ ì‹¤í–‰X
            if (tagValue !== "") {
              // ê°™ì€ íƒœê·¸ê°€ ìˆëŠ”ì§€ ê²€ì‚¬í•œë‹¤. ìˆë‹¤ë©´ í•´ë‹¹ê°’ì´ array ë¡œ return ëœë‹¤.
              var result = Object.values(tag).filter(function (word) {
                return word === tagValue;
              });

              // í•´ì‹œíƒœê·¸ê°€ ì¤‘ë³µë˜ì—ˆëŠ”ì§€ í™•ì¸
              if (result.length == 0) {
                $("#tag-list").append(
                  "<li class='tag-item'>" +
                    tagValue +
                    "<span class='del-btn' idx='" +
                    counter +
                    "'>x</span></li>"
                );
                addTag(tagValue);
                self.val("");
              } else {
                alert("íƒœê·¸ê°’ì´ ì¤‘ë³µë©ë‹ˆë‹¤.");
              }
            }
            e.preventDefault(); // SpaceBar ì‹œ ë¹ˆê³µê°„ì´ ìƒê¸°ì§€ ì•Šë„ë¡ ë°©ì§€
          }
        });

        // ì‚­ì œ ë²„íŠ¼
        // ì¸ë±ìŠ¤ ê²€ì‚¬ í›„ ì‚­ì œ
        $(document).on("click", ".del-btn", function (e) {
          var index = $(this).attr("idx");
          tag[index] = "";
          $(this).parent().remove();
        });
      });
    </script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=fcbbd5cd53c7588e501aae9ea713ff10"
    ></script>
    <script>
      const lat = document.getElementById("lat").value;
      const lng = document.getElementById("lng").value;

      var mapContainer = document.getElementById("map2"), // ì§€ë„ë¥¼ í‘œì‹œí•  div
        mapOption = {
          center: new kakao.maps.LatLng(lat, lng), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
          draggable: false,
          level: 4, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };

      var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

      // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var marker = new kakao.maps.Marker({
        position: markerPosition,
      });

      var markerPosition = new kakao.maps.LatLng(lat, lng); // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤

      // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var marker = new kakao.maps.Marker({
        position: markerPosition,
      });

      // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
      marker.setMap(map);

      const space = document.querySelector("#map2").getAttribute("value");
      console.log(space);

      document.querySelector("#map2").addEventListener("click", function () {
        var center = map.getCenter();

        // ê²€ìƒ‰ì–´ë¥¼ í¬í•¨í•œ ì¹´ì¹´ì˜¤ ë§µ URLì„ ìƒì„±í•©ë‹ˆë‹¤
        var mapUrl = `https://map.kakao.com/link/search/${encodeURIComponent(
          `${space}`
        )}?map_type=DEFAULT&mapX=${center.getLng()}&mapY=${center.getLat()}&q=${encodeURIComponent(
          `${space}`
        )}`;

        // ìƒˆ ì°½ì—ì„œ ì¹´ì¹´ì˜¤ ë§µì„ ì—½ë‹ˆë‹¤
        window.open(mapUrl, "_blank");
      });
    </script>
  </body>
</html>
